@* Modal Component - Reusable modal dialog following modern UX patterns *@

<div class="modal-overlay">
    @if (CloseOnOverlayClick)
    {
        <div class="modal-backdrop" @onclick="Close"></div>
    }
    <div class="modal-dialog modal-@Size @(isExpanded ? "modal-expanded" : "")" @onclick="OnDialogClick">
        <div class="modal-header">
            <div class="modal-header-content">
                @if (!string.IsNullOrEmpty(Breadcrumb))
                {
                    <div class="modal-breadcrumb">
                        <span class="modal-breadcrumb-icon">ðŸ“¦</span>
                        <span class="modal-breadcrumb-text">@Breadcrumb</span>
                        <span class="modal-breadcrumb-separator">â€º</span>
                        <span class="modal-breadcrumb-current">@Title</span>
                    </div>
                }
                else
                {
                    <h2 class="modal-title">@Title</h2>
                }
            </div>
            <div class="modal-header-actions">
                <button type="button" class="modal-action-btn" @onclick="ToggleExpand" aria-label="@(isExpanded ? "Recolher" : "Expandir")">
                    @if (isExpanded)
                    {
                        @* Restore/Minimize icon - two overlapping squares *@
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect x="4" y="6" width="9" height="9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M8 6V5C8 4.44772 8.44772 4 9 4H15C15.5523 4 16 4.44772 16 5V11C16 11.5523 15.5523 12 15 12H14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    }
                    else
                    {
                        @* Maximize icon - arrow pointing outward *@
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M9 4L4 4L4 9M11 16L16 16L16 11" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M4 4L9 9M16 16L11 11" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                    }
                </button>
                <button type="button" class="modal-close" @onclick="Close" aria-label="Fechar">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M15 5L5 15M5 5L15 15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
        </div>
        <div class="modal-body">
            @ChildContent
        </div>
        @if (Footer != null)
        {
            <div class="modal-footer">
                @Footer
            </div>
        }
    </div>
</div>

@code {
    /// <summary>
    /// Modal title displayed in the header
    /// </summary>
    [Parameter]
    public string Title { get; set; } = "";

    /// <summary>
    /// Optional breadcrumb text to show before the title
    /// </summary>
    [Parameter]
    public string? Breadcrumb { get; set; }

    /// <summary>
    /// Modal size: sm (400px), md (540px), lg (720px), xl (960px)
    /// </summary>
    [Parameter]
    public string Size { get; set; } = "md";

    /// <summary>
    /// Modal body content
    /// </summary>
    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    /// <summary>
    /// Optional footer content (for custom action buttons)
    /// </summary>
    [Parameter]
    public RenderFragment? Footer { get; set; }

    /// <summary>
    /// Event callback fired when modal is closed
    /// </summary>
    [Parameter]
    public EventCallback OnClose { get; set; }

    /// <summary>
    /// Whether clicking the overlay should close the modal (default: true)
    /// </summary>
    [Parameter]
    public bool CloseOnOverlayClick { get; set; } = true;

    /// <summary>
    /// Internal state to track if modal is expanded
    /// </summary>
    private bool isExpanded = false;

    /// <summary>
    /// Close the modal
    /// </summary>
    private async Task Close()
    {
        await OnClose.InvokeAsync();
    }

    /// <summary>
    /// Toggle expanded/collapsed state
    /// </summary>
    private void ToggleExpand()
    {
        isExpanded = !isExpanded;
    }

    private void OnDialogClick()
    {
        // Prevents event propagation to backdrop
    }

    protected override void OnInitialized()
    {
        // Add keyboard listener for ESC key
        // Note: In a production app, you'd want to add JavaScript interop for ESC key handling
    }
}
